namespace ViewModels

    '''''''''
    ' SimplePickerItemViewModel
    '
    ' Represents a single selectable item in the picker menu
    '
    ' props:
    '   @item {object} Item object with { text, key }
    '   @isSelected {boolean} Whether this item is currently selected
    '''''''''
    class SimplePickerItemViewModel extends Rotor.ViewModel

        props = {
            item: invalid,
            isSelected: false
        }

        viewModelState = {
            isFocused: false
        }

        override function template() as object
            fontStyle = UI.typography.labelLarge_aa
            itemPaddings = [8, 16]
            itemHeight = fontStyle.size + 2 * itemPaddings[0]

            return {
                nodeType: "Group",
                focus: {
                    onFocusChanged: sub(isFocused as boolean) typecast m as ViewModels.SimplePickerItemViewModel
                        m.viewModelState.isFocused = isFocused
                        m.children.itemBg.refresh("fields.color")
                        m.children.itemLabel.refresh("fields.color")
                    end sub,
                    onSelect: sub() typecast m as ViewModels.SimplePickerItemViewModel
                        ' Notify parent picker of selection
                        m.getParentViewModel().onSelect(m.props.item)
                    end sub
                },
                children: [
                    {
                        id: "itemBg",
                        nodeType: "Rectangle",
                        fields: {
                            color: function() as string
                                if m.viewModelState.isFocused
                                    return UI.colors.secondaryContainer
                                else if m.props.isSelected
                                    return UI.colors.surfaceContainer
                                end if
                                return UI.colors.surfaceContainerLow
                            end function,
                            width: 300,
                            height: itemHeight
                        }
                    },
                    {
                        id: "itemLabel",
                        nodeType: "Label",
                        fontStyle: fontStyle,
                        fields: {
                            text: m.props.item.text,
                            color: function() as string
                                if m.viewModelState.isFocused
                                    return UI.colors.onSecondaryContainer
                                else if m.props.isSelected
                                    return UI.colors.primary
                                end if
                                return UI.colors.onSurface
                            end function,
                            width: 300 - 2 * itemPaddings[1],
                            height: itemHeight,
                            horizAlign: "left",
                            vertAlign: "center",
                            translation: [itemPaddings[1], 0]
                        }
                    }
                ]
            }
        end function

    end class

end namespace
